<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Â· Predictor</title>
  <link rel="stylesheet" href="./styles.css" />

  <style>
    /* Modal (best UX): shows after "DÃ©marrer" */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 22px;
      background: rgba(0,0,0,.58);
      z-index: 999;
    }
    .modalCard {
      width: min(560px, 100%);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow: 0 30px 90px rgba(0,0,0,.70);
      overflow: hidden;
      backdrop-filter: blur(12px);
      animation: pop .18s ease-out forwards;
    }
    @keyframes pop {
      from { transform: translateY(8px) scale(.98); opacity: 0; }
      to { transform: translateY(0) scale(1); opacity: 1; }
    }
    .modalHead{
      padding: 16px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: radial-gradient(900px 260px at 20% 0%, rgba(250,204,21,.14), transparent 58%),
                  radial-gradient(900px 260px at 85% 0%, rgba(96,165,250,.12), transparent 58%),
                  linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
    .modalHead b{
      font-size: 14px;
      font-weight: 1100;
      letter-spacing: .2px;
    }
    .modalClose{
      border: 0;
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 12px;
      color: rgba(245,247,255,.85);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      font-size: 18px;
      line-height: 1;
    }
    .modalBody{ padding: 16px 18px 18px; }
    .modalText{
      margin: 0 0 12px;
      color: rgba(245,247,255,.72);
      font-size: 13.5px;
      line-height: 1.55;
    }
    .modalHint{
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(34,197,94,.25);
      background: rgba(34,197,94,.10);
      color: rgba(245,247,255,.92);
      font-size: 13px;
      line-height: 1.5;
    }
    .modalActions{ display:grid; gap:10px; margin-top: 12px; }
    .modalSmall{
      margin-top: 10px;
      font-size: 11.5px;
      color: rgba(245,247,255,.52);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div class="flag">ğŸ‡¨ğŸ‡©</div>
        <div class="h1" id="t">Congo WinKey</div>
        <div class="h2" id="s">Signaux rapides Â· Fait pour Kinshasa Â· CDF</div>

        <div class="badges">
          <span class="badge gold">ğŸ”’ Secure</span>
          <span class="badge green">âœ… VÃ©rifiÃ©</span>
          <span class="badge blue">ğŸ“ Support local</span>
        </div>
      </div>

      <div class="body">
        <div class="bottom" style="margin-top:0">
          <div class="live">
            <span class="liveDot"></span>
            <span>Utilisateur: <b id="u">â€”</b></span>
            <a class="link" href="#" id="logout" style="margin-left:8px">DÃ©connexion</a>
          </div>
          <div class="timer">AccÃ¨s se ferme dans: <b id="timer">â€”</b></div>
        </div>

        <div style="height:12px"></div>

        <div class="sectionTitle">Choisissez votre jeu</div>
        <div class="games" id="games">
          <div class="opt" data-game="Aviator"><div class="optLeft"><span class="dot"></span><b>Aviator</b></div><i>âœˆï¸</i></div>
          <div class="opt" data-game="Mines"><div class="optLeft"><span class="dot"></span><b>Mines</b></div><i>ğŸ’£</i></div>
          <div class="opt" data-game="Penalty"><div class="optLeft"><span class="dot"></span><b>Penalty</b></div><i>âš½</i></div>
          <div class="opt" data-game="Chicken Road"><div class="optLeft"><span class="dot"></span><b>Chicken Road</b></div><i>ğŸ”</i></div>
          <div class="opt" data-game="Apple Fortune"><div class="optLeft"><span class="dot"></span><b>Apple Fortune</b></div><i>ğŸ</i></div>
          <div class="opt" data-game="Crash"><div class="optLeft"><span class="dot"></span><b>Crash</b></div><i>ğŸ’¥</i></div>
        </div>

        <div class="field">
          <label>1xBet Account ID <small id="hint">Entrez 10 chiffres</small></label>
          <input id="acc" inputmode="numeric" placeholder="Ex: 1471234567" maxlength="10" />
        </div>

        <div class="bar" aria-label="progress"><div id="bar"></div></div>

        <button class="btn" id="start">DÃ©marrer</button>

        <div class="alert" id="msg"></div>

        <div class="bottom">
          <div class="live">
            <span class="liveDot"></span>
            <span>En ligne (est.): <b id="online">â€”</b></span>
          </div>
          <div class="timer">Joueurs / jour: <b id="daily">â€”</b></div>
        </div>
      </div>

      <div class="foot">
        <span>18+ â€¢ Jeu responsable</span>
        <span>Paiements uniquement sur 1xBet</span>
      </div>
    </div>
  </div>

  <!-- MODAL (shows after "DÃ©marrer") -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHead">
        <b id="modalTitle">Activation</b>
        <button class="modalClose" id="closeModal" aria-label="Fermer">âœ•</button>
      </div>
      <div class="modalBody">
        <p class="modalText" id="modalText">
          â€”
        </p>

        <div class="modalActions">
          <button class="btn secondary" id="deposit">ğŸ’³ Faire un dÃ©pÃ´t</button>
          <button class="btn secondary" id="tg">Envoyer la capture (Telegram)</button>
        </div>

        <div class="modalHint" id="modalHint">
          â€”
        </div>

        <div class="modalSmall">
          <span>Ce site ne traite aucun paiement</span>
          <span>Validation via capture</span>
        </div>
      </div>
    </div>
  </div>

  <script src="./config.js"></script>
  <script>
    const A = window.APP;

    if (sessionStorage.getItem("authed") !== "1") location.href = "./index.html";

    document.getElementById("t").textContent = A.TITLE || "Congo WinKey";
    document.getElementById("s").textContent = A.SUBTITLE || "";
    document.getElementById("u").textContent = sessionStorage.getItem("user") || "â€”";

    // Timer
    const key = "expTs";
    if (!sessionStorage.getItem(key)) {
      sessionStorage.setItem(key, String(Date.now() + (A.ACCESS_TIMER_MIN || 8) * 60 * 1000));
    }
    const timerEl = document.getElementById("timer");
    function tick(){
      const exp = Number(sessionStorage.getItem(key) || 0);
      const left = Math.max(0, exp - Date.now());
      const mm = String(Math.floor(left/60000)).padStart(2,"0");
      const ss = String(Math.floor((left%60000)/1000)).padStart(2,"0");
      timerEl.textContent = `${mm}:${ss}`;
    }
    tick(); setInterval(tick, 500);

    // Daily players
    const min = Number(A.DAILY_PLAYERS_MIN || 930);
    const max = Number(A.DAILY_PLAYERS_MAX || 1100);
    document.getElementById("daily").textContent = `${min.toLocaleString("fr-FR")}â€“${max.toLocaleString("fr-FR")}`;

    // Online estimate (est.)
    function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }
    function mulberry32(seed){
      return function(){
        seed |= 0; seed = seed + 0x6D2B79F5 | 0;
        let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
        t ^= t + Math.imul(t ^ t >>> 7, 61 | t);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      };
    }
    function estimateOnline(){
      const now = new Date();
      const h = now.getHours() + now.getMinutes()/60;
      const peak1 = Math.exp(-Math.pow((h - 13.0)/3.0, 2));
      const peak2 = Math.exp(-Math.pow((h - 20.0)/3.0, 2));
      let intensity = 0.10 + 0.55*peak1 + 0.75*peak2;
      intensity = clamp(intensity, 0.10, 1.00);
      const activeShare = 0.03 + 0.07*intensity;
      const dailyMid = (min + max)/2;
      const seed = now.getFullYear()*1000000 + (now.getMonth()+1)*10000 + now.getDate()*100 + now.getHours();
      const rnd = mulberry32(seed)();
      const jitter = 0.92 + rnd*0.16;
      const est = Math.round(dailyMid * activeShare * jitter);
      return clamp(est, 20, Math.round(max*0.14));
    }
    const onlineEl = document.getElementById("online");
    function updateOnline(){ onlineEl.textContent = `~ ${estimateOnline().toLocaleString("fr-FR")}`; }
    updateOnline(); setInterval(updateOnline, 20000);

    // Game selection
    let selectedGame = "";
    const gameNodes = Array.from(document.querySelectorAll(".opt"));
    gameNodes.forEach(n=>{
      n.addEventListener("click", ()=>{
        gameNodes.forEach(x=>x.classList.remove("active"));
        n.classList.add("active");
        selectedGame = n.getAttribute("data-game") || "";
      });
    });

    // ID validation
    const hint = document.getElementById("hint");
    if (A.REQUIRED_PREFIX) hint.textContent = `Entrez ${A.ACCOUNT_ID_LENGTH || 10} chiffres (doit commencer par ${A.REQUIRED_PREFIX})`;

    const acc = document.getElementById("acc");
    acc.addEventListener("input", ()=>{
      const L = (A.ACCOUNT_ID_LENGTH || 10);
      acc.value = acc.value.replace(/\D/g,"").slice(0, L);
    });

    // UI helpers
    const bar = document.getElementById("bar");
    const msg = document.getElementById("msg");

    function showMsg(text){
      msg.className = "alert";
      msg.style.display = "block";
      msg.textContent = text;
    }

    function validate(){
      const id = acc.value.trim();
      const L = (A.ACCOUNT_ID_LENGTH || 10);
      if(!selectedGame) return "Choisissez un jeu.";
      if(id.length !== L) return `Entrez ${L} chiffres pour l'ID.`;
      if(A.REQUIRED_PREFIX && !id.startsWith(A.REQUIRED_PREFIX)) return `L'ID doit commencer par ${A.REQUIRED_PREFIX}.`;
      return "";
    }

    // Modal logic
    const modal = document.getElementById("modal");
    const modalText = document.getElementById("modalText");
    const modalHint = document.getElementById("modalHint");
    const closeModalBtn = document.getElementById("closeModal");

    function openModal(){
      modal.style.display = "flex";
      modal.setAttribute("aria-hidden","false");
    }
    function closeModal(){
      modal.style.display = "none";
      modal.setAttribute("aria-hidden","true");
    }
    closeModalBtn.addEventListener("click", closeModal);
    modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

    // Start flow -> show modal AFTER progress
    document.getElementById("start").addEventListener("click", ()=>{
      const err = validate();
      if(err){
        bar.style.width = "0%";
        return showMsg(err);
      }

      msg.style.display = "none";
      bar.style.width = "0%";

      let p = 0;
      const t = setInterval(()=>{
        p += 18;
        bar.style.width = Math.min(100, p) + "%";
        if(p >= 100){
          clearInterval(t);

          const amountText = `${Number(A.DEPOSIT_AMOUNT || 8000).toLocaleString("fr-FR")} ${A.CURRENCY || "CDF"}`;
          modalText.textContent = `Session prÃªte pour ${selectedGame}. Pour activer lâ€™accÃ¨s, effectuez un dÃ©pÃ´t de ${amountText} sur 1xBet.`;
          modalHint.textContent = `Ensuite, envoyez la capture dâ€™Ã©cran du dÃ©pÃ´t via Telegram pour validation.`;

          openModal();
        }
      }, 220);
    });

    // Deposit redirect
    document.getElementById("deposit").addEventListener("click", ()=>{
      window.open(A.OFFICIAL_1XBET_URL, "_blank", "noopener,noreferrer");
    });

    // Telegram send
    function depositText(){
      const amountText = `${Number(A.DEPOSIT_AMOUNT || 8000).toLocaleString("fr-FR")} ${A.CURRENCY || "CDF"}`;
      const user = sessionStorage.getItem("user") || "";
      const id = acc.value.trim() || "â€”";
      const game = selectedGame || "â€”";
      return `Bonjour. Jâ€™ai effectuÃ© le dÃ©pÃ´t ${amountText}. Login: ${user}. ID: ${id}. Jeu: ${game}. Jâ€™envoie la capture dâ€™Ã©cran maintenant.`;
    }
    document.getElementById("tg").addEventListener("click", ()=>{
      const text = encodeURIComponent(depositText());
      window.open(`https://t.me/${A.TELEGRAM_USERNAME}?text=${text}`, "_blank", "noopener,noreferrer");
    });

    // Logout
    document.getElementById("logout").addEventListener("click", (e)=>{
      e.preventDefault();
      sessionStorage.clear();
      location.href = "./index.html";
    });
  </script>
</body>
</html>
