<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Â· Predictor</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div class="flag">ğŸ‡¨ğŸ‡©</div>
        <div class="h1" id="t">Congo WinKey</div>
        <div class="h2" id="s">Signaux rapides Â· Fait pour Kinshasa Â· CDF</div>

        <div class="badges">
          <span class="badge gold">ğŸ”’ Secure</span>
          <span class="badge green">âœ… VÃ©rifiÃ©</span>
          <span class="badge blue">ğŸ“ Support local</span>
        </div>
      </div>

      <div class="body">
        <div class="bottom" style="margin-top:0">
          <div class="live">
            <span class="liveDot"></span>
            <span>Utilisateur: <b id="u">â€”</b></span>
            <a class="link" href="#" id="logout" style="margin-left:8px">DÃ©connexion</a>
          </div>
          <div class="timer">AccÃ¨s se ferme dans: <b id="timer">â€”</b></div>
        </div>

        <div style="height:12px"></div>

        <div class="sectionTitle">Choisissez votre jeu</div>
        <div class="games" id="games">
          <div class="opt" data-game="Aviator"><div class="optLeft"><span class="dot"></span><b>Aviator</b></div><i>âœˆï¸</i></div>
          <div class="opt" data-game="Mines"><div class="optLeft"><span class="dot"></span><b>Mines</b></div><i>ğŸ’£</i></div>
          <div class="opt" data-game="Penalty"><div class="optLeft"><span class="dot"></span><b>Penalty</b></div><i>âš½</i></div>
          <div class="opt" data-game="Chicken Road"><div class="optLeft"><span class="dot"></span><b>Chicken Road</b></div><i>ğŸ”</i></div>
          <div class="opt" data-game="Apple Fortune"><div class="optLeft"><span class="dot"></span><b>Apple Fortune</b></div><i>ğŸ</i></div>
          <div class="opt" data-game="Crash"><div class="optLeft"><span class="dot"></span><b>Crash</b></div><i>ğŸ’¥</i></div>
        </div>

        <div class="field">
          <label>1xBet Account ID <small id="hint">Entrez 10 chiffres</small></label>
          <input id="acc" inputmode="numeric" placeholder="Ex: 1471234567" maxlength="10" />
        </div>

        <div class="bar" aria-label="progress"><div id="bar"></div></div>

        <button class="btn" id="start">DÃ©marrer</button>
        <button class="btn secondary" id="deposit">ğŸ’³ Faire un dÃ©pÃ´t</button>

        <div class="row2">
          <button class="btn secondary" id="tg">Envoyer la capture (Telegram)</button>
          <button class="btn secondary" id="wa">Envoyer la capture (WhatsApp)</button>
        </div>

        <div class="alert" id="msg"></div>

        <div class="bottom">
          <div class="live">
            <span class="liveDot"></span>
            <span>En ligne (est.): <b id="online">â€”</b></span>
          </div>
          <div class="timer">Joueurs / jour: <b id="daily">â€”</b></div>
        </div>
      </div>

      <div class="foot">
        <span>18+ â€¢ Jeu responsable</span>
        <span>Paiements uniquement sur 1xBet</span>
      </div>
    </div>
  </div>

  <script src="./config.js"></script>
  <script>
    const A = window.APP;

    if (sessionStorage.getItem("authed") !== "1") location.href = "./index.html";

    document.getElementById("t").textContent = A.TITLE || "Congo WinKey";
    document.getElementById("s").textContent = A.SUBTITLE || "";
    document.getElementById("u").textContent = sessionStorage.getItem("user") || "â€”";

    // Timer
    const key = "expTs";
    if (!sessionStorage.getItem(key)) {
      sessionStorage.setItem(key, String(Date.now() + (A.ACCESS_TIMER_MIN || 8) * 60 * 1000));
    }
    const timerEl = document.getElementById("timer");
    function tick(){
      const exp = Number(sessionStorage.getItem(key) || 0);
      const left = Math.max(0, exp - Date.now());
      const mm = String(Math.floor(left/60000)).padStart(2,"0");
      const ss = String(Math.floor((left%60000)/1000)).padStart(2,"0");
      timerEl.textContent = `${mm}:${ss}`;
      if(left === 0){
        showMsg("Session expirÃ©e. Reconnectez-vous.", false);
      }
    }
    tick(); setInterval(tick, 500);

    // Daily players
    const min = Number(A.DAILY_PLAYERS_MIN || 930);
    const max = Number(A.DAILY_PLAYERS_MAX || 1100);
    document.getElementById("daily").textContent = `${min.toLocaleString("fr-FR")}â€“${max.toLocaleString("fr-FR")}`;

    // Online estimate (clearly labeled est.)
    function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }
    function mulberry32(seed){
      return function(){
        seed |= 0; seed = seed + 0x6D2B79F5 | 0;
        let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
        t ^= t + Math.imul(t ^ t >>> 7, 61 | t);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      };
    }
    function estimateOnline(){
      const now = new Date();
      const h = now.getHours() + now.getMinutes()/60;

      const peak1 = Math.exp(-Math.pow((h - 13.0)/3.0, 2));
      const peak2 = Math.exp(-Math.pow((h - 20.0)/3.0, 2));
      let intensity = 0.10 + 0.55*peak1 + 0.75*peak2;
      intensity = clamp(intensity, 0.10, 1.00);

      const activeShare = 0.03 + 0.07*intensity; // 3%..10%
      const dailyMid = (min + max)/2;

      const seed = now.getFullYear()*1000000 + (now.getMonth()+1)*10000 + now.getDate()*100 + now.getHours();
      const rnd = mulberry32(seed)();
      const jitter = 0.92 + rnd*0.16;

      const est = Math.round(dailyMid * activeShare * jitter);
      return clamp(est, 20, Math.round(max*0.14));
    }
    const onlineEl = document.getElementById("online");
    function updateOnline(){
      onlineEl.textContent = `~ ${estimateOnline().toLocaleString("fr-FR")}`;
    }
    updateOnline(); setInterval(updateOnline, 20000);

    // Game selection
    let selectedGame = "";
    const gameNodes = Array.from(document.querySelectorAll(".opt"));
    gameNodes.forEach(n=>{
      n.addEventListener("click", ()=>{
        gameNodes.forEach(x=>x.classList.remove("active"));
        n.classList.add("active");
        selectedGame = n.getAttribute("data-game") || "";
      });
    });

    // Account ID hint / validation
    const hint = document.getElementById("hint");
    if (A.REQUIRED_PREFIX) hint.textContent = `Entrez ${A.ACCOUNT_ID_LENGTH} chiffres (doit commencer par ${A.REQUIRED_PREFIX})`;

    const acc = document.getElementById("acc");
    acc.addEventListener("input", ()=>{
      acc.value = acc.value.replace(/\D/g,"").slice(0, A.ACCOUNT_ID_LENGTH || 10);
    });

    // Progress + messages
    const bar = document.getElementById("bar");
    const msg = document.getElementById("msg");
    function showMsg(text, ok){
      msg.className = "alert" + (ok ? " ok" : "");
      msg.style.display = "block";
      msg.textContent = text;
    }

    function validate(){
      const id = acc.value.trim();
      if(!selectedGame) return "Choisissez un jeu.";
      if(id.length !== (A.ACCOUNT_ID_LENGTH || 10)) return `Entrez ${A.ACCOUNT_ID_LENGTH || 10} chiffres pour l'ID.`;
      if(A.REQUIRED_PREFIX && !id.startsWith(A.REQUIRED_PREFIX)) return `L'ID doit commencer par ${A.REQUIRED_PREFIX}.`;
      return "";
    }

    document.getElementById("start").addEventListener("click", ()=>{
      const err = validate();
      if(err) return showMsg(err, false);

      msg.style.display = "none";
      bar.style.width = "0%";
      let p = 0;
      const t = setInterval(()=>{
        p += 18;
        bar.style.width = Math.min(100, p) + "%";
        if(p >= 100){
          clearInterval(t);
          // No fake â€œverificationâ€: just clear instruction
          showMsg(`Session prÃªte pour ${selectedGame}. Pour activer lâ€™accÃ¨s, effectuez un dÃ©pÃ´t de ${Number(A.DEPOSIT_AMOUNT).toLocaleString("fr-FR")} ${A.CURRENCY} sur 1xBet, puis envoyez la capture.`, true);
        }
      }, 220);
    });

    // Deposit redirect
    document.getElementById("deposit").addEventListener("click", ()=>{
      window.open(A.OFFICIAL_1XBET_URL, "_blank", "noopener,noreferrer");
    });

    // Send screenshot
    function depositText(){
      const amountText = `${Number(A.DEPOSIT_AMOUNT || 8000).toLocaleString("fr-FR")} ${A.CURRENCY || "CDF"}`;
      const user = sessionStorage.getItem("user") || "";
      const id = acc.value.trim() || "â€”";
      const game = selectedGame || "â€”";
      return `Bonjour. Jâ€™ai effectuÃ© le dÃ©pÃ´t ${amountText}. Login: ${user}. ID: ${id}. Jeu: ${game}. Jâ€™envoie la capture dâ€™Ã©cran maintenant.`;
    }

    document.getElementById("tg").addEventListener("click", ()=>{
      const text = encodeURIComponent(depositText());
      window.open(`https://t.me/${A.TELEGRAM_USERNAME}?text=${text}`, "_blank", "noopener,noreferrer");
    });

    document.getElementById("wa").addEventListener("click", ()=>{
      const text = encodeURIComponent(depositText());
      window.open(`https://wa.me/${A.WHATSAPP_NUMBER}?text=${text}`, "_blank", "noopener,noreferrer");
    });

    // Logout
    document.getElementById("logout").addEventListener("click", (e)=>{
      e.preventDefault();
      sessionStorage.clear();
      location.href = "./index.html";
    });
  </script>
</body>
</html>
